"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8690],{88690:function(e,t,a){a.d(t,{$D:function(){return _},jR:function(){return Y},wd:function(){return N},js:function(){return Z}});var s=a(57437),r=a(2265),i=a(6760),o=a(85260),l=a(30688),n=a(72478),c=a(649),d=a(44316);class u{async addBookToCourse(e,t,a){var s,r;let{data:i,error:o}=await this.supabase.from("course_books").insert({course_id:e,book_id:t,is_required:null!==(s=null==a?void 0:a.isRequired)&&void 0!==s&&s,notes:null==a?void 0:a.notes,position:null!==(r=null==a?void 0:a.position)&&void 0!==r?r:0}).select().single();if(o)throw o;return i}async removeBookFromCourse(e,t){let{error:a}=await this.supabase.from("course_books").delete().match({course_id:e,book_id:t});if(a)throw a}async getCourseBooksWithDetails(e){let{data:t,error:a}=await this.supabase.from("course_books").select("\n        *,\n        book:books (\n          id,\n          title,\n          author,\n          isbn,\n          publisher,\n          publication_year,\n          cover_image_url,\n          content_type,\n          file_url\n        )\n      ").eq("course_id",e).order("position",{ascending:!0});if(a)throw a;return t}async getCoursesUsingBook(e){let{data:t,error:a}=await this.supabase.from("course_books").select("\n        *,\n        course:courses (\n          id,\n          title,\n          description,\n          status,\n          difficulty\n        )\n      ").eq("book_id",e);if(a)throw a;return t}async updateCourseBook(e,t,a){let{data:s,error:r}=await this.supabase.from("course_books").update({is_required:a.isRequired,notes:a.notes,position:a.position}).match({course_id:e,book_id:t}).select().single();if(r)throw r;return s}async reorderCourseBooks(e,t){let a=t.map(t=>{let{bookId:a,position:s}=t;return this.supabase.from("course_books").update({position:s}).match({course_id:e,book_id:a})}),s=(await Promise.all(a)).filter(e=>e.error);if(s.length>0)throw Error("Failed to reorder books: ".concat(s.map(e=>{var t;return null===(t=e.error)||void 0===t?void 0:t.message}).join(", ")))}async bulkAddBooksToCourse(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=t.map((t,s)=>({course_id:e,book_id:t,is_required:a,position:s})),{data:r,error:i}=await this.supabase.from("course_books").insert(s).select();if(i)throw i;return r}async isBookInCourse(e,t){let{data:a,error:s}=await this.supabase.from("course_books").select("id").match({course_id:e,book_id:t}).single();if(s&&"PGRST116"!==s.code)throw s;return!!a}constructor(){this.supabase=(0,d.J)()}}let m=new u;class h{async addVocabularyGroupToCourse(e,t,a){let{data:s,error:r}=await this.supabase.from("course_vocabulary_groups").insert({course_id:e,vocabulary_group_id:t,position:null!=a?a:0}).select().single();if(r)throw r;return s}async removeVocabularyGroupFromCourse(e,t){let{error:a}=await this.supabase.from("course_vocabulary_groups").delete().match({course_id:e,vocabulary_group_id:t});if(a)throw a}async getCourseVocabularyGroups(e){let{data:t,error:a}=await this.supabase.from("course_vocabulary_groups").select("\n        *,\n        vocabulary_group:vocabulary_groups (\n          id,\n          name,\n          description,\n          language,\n          target_language,\n          difficulty,\n          tags,\n          vocabulary_group_items (\n            vocabulary:vocabulary (\n              id,\n              word,\n              translation,\n              part_of_speech,\n              difficulty\n            )\n          )\n        )\n      ").eq("course_id",e).order("position",{ascending:!0});if(a)throw a;return t}async getCourseVocabularyItems(e){let{data:t,error:a}=await this.supabase.from("course_vocabulary_groups").select("\n        vocabulary_group:vocabulary_groups (\n          id,\n          name,\n          vocabulary_group_items (\n            vocabulary:vocabulary (*)\n          )\n        )\n      ").eq("course_id",e);if(a)throw a;return null==t?void 0:t.flatMap(e=>{var t,a;let s=e.vocabulary_group;return null!==(a=null==s?void 0:null===(t=s.vocabulary_group_items)||void 0===t?void 0:t.map(e=>e.vocabulary))&&void 0!==a?a:[]}).filter(Boolean)}async getCoursesUsingVocabularyGroup(e){let{data:t,error:a}=await this.supabase.from("course_vocabulary_groups").select("\n        *,\n        course:courses (\n          id,\n          title,\n          description,\n          status,\n          difficulty\n        )\n      ").eq("vocabulary_group_id",e);if(a)throw a;return t}async reorderCourseVocabularyGroups(e,t){let a=t.map(t=>{let{groupId:a,position:s}=t;return this.supabase.from("course_vocabulary_groups").update({position:s}).match({course_id:e,vocabulary_group_id:a})}),s=(await Promise.all(a)).filter(e=>e.error);if(s.length>0)throw Error("Failed to reorder vocabulary groups: ".concat(s.map(e=>{var t;return null===(t=e.error)||void 0===t?void 0:t.message}).join(", ")))}async bulkAddVocabularyGroupsToCourse(e,t){let a=t.map((t,a)=>({course_id:e,vocabulary_group_id:t,position:a})),{data:s,error:r}=await this.supabase.from("course_vocabulary_groups").insert(a).select();if(r)throw r;return s}async getCourseVocabularyStats(e){let t=await this.getCourseVocabularyItems(e),a={totalWords:t.length,byDifficulty:{},byPartOfSpeech:{},languages:new Set};return t.forEach(e=>{if(e){let t=e.difficulty||"unknown";a.byDifficulty[t]=(a.byDifficulty[t]||0)+1;let s=e.part_of_speech||"unknown";a.byPartOfSpeech[s]=(a.byPartOfSpeech[s]||0)+1}}),a}constructor(){this.supabase=(0,d.J)()}}let g=new h;class v{async linkScheduleToCourse(e,t){let{data:a,error:s}=await this.supabase.from("schedules").update({course_id:t}).eq("id",e).select().single();if(s)throw s;return a}async unlinkScheduleFromCourse(e){let{data:t,error:a}=await this.supabase.from("schedules").update({course_id:null}).eq("id",e).select().single();if(a)throw a;return t}async getCourseSchedules(e){let{data:t,error:a}=await this.supabase.from("schedules").select("\n        *,\n        lessons (\n          id,\n          title,\n          date,\n          start_time,\n          end_time,\n          status\n        )\n      ").eq("course_id",e).order("start_date",{ascending:!0});if(a)throw a;return t}async getActiveCourseSchedules(e){let{data:t,error:a}=await this.supabase.from("schedules").select("\n        *,\n        lessons (\n          id,\n          title,\n          date,\n          start_time,\n          end_time,\n          status\n        )\n      ").eq("course_id",e).eq("is_active",!0).gte("end_date",new Date().toISOString().split("T")[0]).order("start_date",{ascending:!0});if(a)throw a;return t}async getScheduleCourse(e){let{data:t,error:a}=await this.supabase.from("schedules").select("\n        course:courses (\n          id,\n          title,\n          description,\n          status,\n          difficulty\n        )\n      ").eq("id",e).single();if(a)throw a;return null==t?void 0:t.course}async getCourseLessons(e){let{data:t,error:a}=await this.supabase.from("schedules").select("\n        lessons (\n          *,\n          schedule:schedules (\n            id,\n            name\n          )\n        )\n      ").eq("course_id",e);if(a)throw a;return null==t?void 0:t.flatMap(e=>{var t,a;return null!==(a=null===(t=e.lessons)||void 0===t?void 0:t.map(t=>({...t,schedule:e})))&&void 0!==a?a:[]})}async getUpcomingCourseLessons(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=new Date().toISOString().split("T")[0],{data:s,error:r}=await this.supabase.from("schedules").select("\n        lessons (\n          *,\n          schedule:schedules (\n            id,\n            name\n          )\n        )\n      ").eq("course_id",e).eq("is_active",!0);if(r)throw r;return null==s?void 0:s.flatMap(e=>{var t,s;return null!==(s=null===(t=e.lessons)||void 0===t?void 0:t.filter(e=>e.date>=a))&&void 0!==s?s:[]}).sort((e,t)=>{let a=e.date.localeCompare(t.date);return 0!==a?a:e.start_time.localeCompare(t.start_time)}).slice(0,t)}async courseHasSchedules(e){let{count:t,error:a}=await this.supabase.from("schedules").select("*",{count:"exact",head:!0}).eq("course_id",e);if(a)throw a;return(null!=t?t:0)>0}async getCourseProgress(e){var t;let{data:a,error:s}=await this.supabase.from("schedules").select("\n        lessons (\n          status\n        )\n      ").eq("course_id",e);if(s)throw s;let r=null!==(t=null==a?void 0:a.flatMap(e=>{var t;return null!==(t=e.lessons)&&void 0!==t?t:[]}))&&void 0!==t?t:[],i=r.filter(e=>"completed"===e.status);return{totalLessons:r.length,completedLessons:i.length,progressPercentage:r.length>0?Math.round(i.length/r.length*100):0}}async createCourseSchedule(e,t){let{data:a,error:s}=await this.supabase.auth.getUser();if(s)throw s;let{data:r,error:i}=await this.supabase.from("schedules").insert({...t,course_id:e,user_id:a.user.id}).select().single();if(i)throw i;return r}constructor(){this.supabase=(0,d.J)()}}new v;class y{async addObjectiveToLesson(e,t,a){let{data:s,error:r}=await this.supabase.from("lesson_objectives").insert({lesson_id:e,objective_id:t,position:null!=a?a:0}).select().single();if(r)throw r;return s}async removeObjectiveFromLesson(e,t){let{error:a}=await this.supabase.from("lesson_objectives").delete().match({lesson_id:e,objective_id:t});if(a)throw a}async getLessonObjectives(e){let{data:t,error:a}=await this.supabase.from("lesson_objectives").select("\n        *,\n        objective:objectives (*)\n      ").eq("lesson_id",e).order("position",{ascending:!0});if(a)throw a;return t}async addMethodToLesson(e,t,a){var s;let{data:r,error:i}=await this.supabase.from("lesson_methods").insert({lesson_id:e,method_id:t,duration_override:null==a?void 0:a.durationOverride,position:null!==(s=null==a?void 0:a.position)&&void 0!==s?s:0,notes:null==a?void 0:a.notes}).select().single();if(i)throw i;return r}async removeMethodFromLesson(e,t){let{error:a}=await this.supabase.from("lesson_methods").delete().match({lesson_id:e,method_id:t});if(a)throw a}async getLessonMethods(e){let{data:t,error:a}=await this.supabase.from("lesson_methods").select("\n        *,\n        method:methods (*)\n      ").eq("lesson_id",e).order("position",{ascending:!0});if(a)throw a;return t}async addTaskToLesson(e,t,a){var s,r;let{data:i,error:o}=await this.supabase.from("lesson_tasks").insert({lesson_id:e,task_id:t,duration_override:null==a?void 0:a.durationOverride,position:null!==(s=null==a?void 0:a.position)&&void 0!==s?s:0,notes:null==a?void 0:a.notes,is_homework:null!==(r=null==a?void 0:a.isHomework)&&void 0!==r&&r,due_date:null==a?void 0:a.dueDate}).select().single();if(o)throw o;return i}async removeTaskFromLesson(e,t){let{error:a}=await this.supabase.from("lesson_tasks").delete().match({lesson_id:e,task_id:t});if(a)throw a}async getLessonTasks(e){let{data:t,error:a}=await this.supabase.from("lesson_tasks").select("\n        *,\n        task:tasks (*)\n      ").eq("lesson_id",e).order("position",{ascending:!0});if(a)throw a;return t}async addBookToLesson(e,t,a){let{data:s,error:r}=await this.supabase.from("lesson_books").insert({lesson_id:e,book_id:t,pages_from:null==a?void 0:a.pagesFrom,pages_to:null==a?void 0:a.pagesTo,notes:null==a?void 0:a.notes}).select().single();if(r)throw r;return s}async removeBookFromLesson(e,t){let{error:a}=await this.supabase.from("lesson_books").delete().match({lesson_id:e,book_id:t});if(a)throw a}async getLessonBooks(e){let{data:t,error:a}=await this.supabase.from("lesson_books").select("\n        *,\n        book:books (\n          id,\n          title,\n          author,\n          cover_image_url\n        )\n      ").eq("lesson_id",e);if(a)throw a;return t}async addVocabularyToLesson(e,t,a){let{data:s,error:r}=await this.supabase.from("lesson_vocabulary").insert({lesson_id:e,vocabulary_id:t,position:null!=a?a:0}).select().single();if(r)throw r;return s}async removeVocabularyFromLesson(e,t){let{error:a}=await this.supabase.from("lesson_vocabulary").delete().match({lesson_id:e,vocabulary_id:t});if(a)throw a}async getLessonVocabulary(e){let{data:t,error:a}=await this.supabase.from("lesson_vocabulary").select("\n        *,\n        vocabulary:vocabulary (*)\n      ").eq("lesson_id",e).order("position",{ascending:!0});if(a)throw a;return t}async bulkAddObjectivesToLesson(e,t){let a=t.map((t,a)=>({lesson_id:e,objective_id:t,position:a})),{data:s,error:r}=await this.supabase.from("lesson_objectives").insert(a).select();if(r)throw r;return s}async bulkAddMethodsToLesson(e,t){let a=t.map((t,a)=>({lesson_id:e,method_id:t.methodId,duration_override:t.durationOverride,notes:t.notes,position:a})),{data:s,error:r}=await this.supabase.from("lesson_methods").insert(a).select();if(r)throw r;return s}async bulkAddTasksToLesson(e,t){let a=t.map((t,a)=>{var s;return{lesson_id:e,task_id:t.taskId,duration_override:t.durationOverride,notes:t.notes,is_homework:null!==(s=t.isHomework)&&void 0!==s&&s,due_date:t.dueDate,position:a}}),{data:s,error:r}=await this.supabase.from("lesson_tasks").insert(a).select();if(r)throw r;return s}async getLessonContent(e){let[t,a,s,r,i]=await Promise.all([this.getLessonObjectives(e),this.getLessonMethods(e),this.getLessonTasks(e),this.getLessonBooks(e),this.getLessonVocabulary(e)]);return{objectives:t,methods:a,tasks:s,books:r,vocabulary:i}}async copyLessonContent(e,t){let a=await this.getLessonContent(e);for(let e of(a.objectives.length>0&&await this.bulkAddObjectivesToLesson(t,a.objectives.map(e=>e.objective_id)),a.methods.length>0&&await this.bulkAddMethodsToLesson(t,a.methods.map(e=>({methodId:e.method_id,durationOverride:e.duration_override||void 0,notes:e.notes||void 0}))),a.tasks.length>0&&await this.bulkAddTasksToLesson(t,a.tasks.map(e=>({taskId:e.task_id,durationOverride:e.duration_override||void 0,notes:e.notes||void 0,isHomework:e.is_homework,dueDate:e.due_date||void 0}))),a.books))await this.addBookToLesson(t,e.book_id,{pagesFrom:e.pages_from||void 0,pagesTo:e.pages_to||void 0,notes:e.notes||void 0});if(a.vocabulary.length>0){let e=a.vocabulary.map((e,a)=>({lesson_id:t,vocabulary_id:e.vocabulary_id,position:a}));await this.supabase.from("lesson_vocabulary").insert(e)}}constructor(){this.supabase=(0,d.J)()}}let p=new y;var f=a(46749),b=a(58948),x=a(3274);function _(e){let{courseId:t,onUpdate:a}=e,[d,u]=(0,r.useState)(!1),[h,g]=(0,r.useState)(""),[v,y]=(0,r.useState)([]),[p,_]=(0,r.useState)([]),[w,j]=(0,r.useState)([]),[k,N]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),q=async()=>{try{let e=await m.getCourseBooksWithDetails(t);_(e||[])}catch(e){console.error("Failed to load course books:",e)}},L=async()=>{S(!0);try{let e=await f.a.getBooks(),t=p.map(e=>e.book_id),a=e.filter(e=>!t.includes(e.id));j(a)}catch(e){console.error("Failed to load available books:",e)}finally{S(!1)}};(0,r.useEffect)(()=>{q()},[t]);let T=async()=>{u(!0),y([]),g(""),await L()},z=async()=>{if(0!==v.length){N(!0);try{await m.bulkAddBooksToCourse(t,v),y([]),await q(),null==a||a(),u(!1)}catch(e){console.error("Failed to add books:",e)}finally{N(!1)}}},D=async e=>{if(confirm("Are you sure you want to remove this book from the course?"))try{await m.removeBookFromCourse(t,e),await q(),null==a||a()}catch(e){console.error("Failed to remove book:",e)}},O=async(e,a)=>{try{await m.updateCourseBook(t,e,{isRequired:!a}),await q()}catch(e){console.error("Failed to update book:",e)}},U=e=>{v.includes(e)?y(v.filter(t=>t!==e)):y([...v,e])},A=w.filter(e=>{var t,a;return(e.title||"").toLowerCase().includes(h.toLowerCase())||(null===(t=e.author)||void 0===t?void 0:t.toLowerCase().includes(h.toLowerCase()))||(null===(a=e.isbn)||void 0===a?void 0:a.toLowerCase().includes(h.toLowerCase()))});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Course Books"}),(0,s.jsxs)(i.z,{onClick:T,size:"sm",children:[(0,s.jsx)(b.Z,{className:"h-4 w-4 mr-2"}),"Manage Books"]})]}),p.length>0?(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3",children:p.map(e=>{var t,a,r,o;return(0,s.jsxs)("div",{className:"border rounded-lg p-2 hover:shadow-md transition-shadow group relative",children:[(null===(t=e.book)||void 0===t?void 0:t.cover_image_url)&&(0,s.jsx)("img",{src:e.book.cover_image_url,alt:e.book.title,className:"w-full h-24 object-cover rounded mb-2"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h4",{className:"font-medium text-xs line-clamp-2",title:null===(a=e.book)||void 0===a?void 0:a.title,children:null===(r=e.book)||void 0===r?void 0:r.title}),(null===(o=e.book)||void 0===o?void 0:o.author)&&(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-1",title:e.book.author,children:e.book.author}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(c.C,{variant:e.is_required?"default":"secondary",className:"cursor-pointer text-xs px-1 py-0.5",onClick:()=>O(e.book_id,e.is_required),children:e.is_required?"Req":"Opt"}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>D(e.book_id),className:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 p-0 text-red-600 hover:text-red-700",children:"\xd7"})]})]})]},e.id)})}):(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No books added to this course yet."})]}),(0,s.jsx)(o.u,{isOpen:d,onClose:()=>u(!1),title:"Add Books to Course",size:"lg",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(l.R,{value:h,onSearch:g,placeholder:"Search books by title, author, or ISBN..."}),C?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)(x.Z,{className:"h-8 w-8 animate-spin text-gray-400"})}):A.length>0?(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto",children:(0,s.jsx)(n.iA,{columns:[{key:"select",label:(0,s.jsx)("input",{type:"checkbox",checked:A.length>0&&A.every(e=>v.includes(e.id)),onChange:e=>{e.target.checked?y(A.map(e=>e.id)):y([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),render:e=>(0,s.jsx)("input",{type:"checkbox",checked:v.includes(e.id),onChange:()=>U(e.id),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})},{key:"title",label:"Title",render:e=>(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.title}),e.isbn&&(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["ISBN: ",e.isbn]})]})},{key:"author",label:"Author"},{key:"category",label:"Category",render:e=>{var t;return(null===(t=e.category)||void 0===t?void 0:t.name)||"-"}},{key:"type",label:"Type",render:e=>(0,s.jsx)(c.C,{variant:"warning",children:e.content_type||"physical"})}],data:A})}):(0,s.jsx)("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:h?"No books found matching your search.":"No available books to add."}),(0,s.jsxs)("div",{className:"flex justify-between items-center border-t pt-4",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[v.length," book",1!==v.length?"s":""," selected"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),(0,s.jsx)(i.z,{onClick:z,disabled:0===v.length||k,loading:k,children:"Add Books"})]})]})]})})]})}var w=a(31868),j=a(39897),k=a(6540);function N(e){let{courseId:t,onUpdate:a}=e,[n,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(""),[h,v]=(0,r.useState)([]),[y,p]=(0,r.useState)([]),[f,b]=(0,r.useState)([]),[_,N]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[q,L]=(0,r.useState)(null),T=async()=>{try{let e=await g.getCourseVocabularyGroups(t);p(e||[]);let a=await g.getCourseVocabularyStats(t);L(a)}catch(e){console.error("Failed to load course vocabulary groups:",e)}},z=async()=>{S(!0);try{let e=await w.A.getVocabularyGroups(),t=y.map(e=>e.vocabulary_group_id),a=e.filter(e=>!t.includes(e.id));b(a)}catch(e){console.error("Failed to load available groups:",e)}finally{S(!1)}};(0,r.useEffect)(()=>{T()},[t]);let D=async()=>{d(!0),v([]),m(""),await z()},O=async()=>{if(0!==h.length){N(!0);try{await g.bulkAddVocabularyGroupsToCourse(t,h),v([]),await T(),null==a||a(),d(!1)}catch(e){console.error("Failed to add vocabulary groups:",e)}finally{N(!1)}}},U=async e=>{if(confirm("Are you sure you want to remove this vocabulary group from the course?"))try{await g.removeVocabularyGroupFromCourse(t,e),await T(),null==a||a()}catch(e){console.error("Failed to remove vocabulary group:",e)}},A=e=>{h.includes(e)?v(h.filter(t=>t!==e)):v([...h,e])},B=f.filter(e=>{var t,a,s;return e.name.toLowerCase().includes(u.toLowerCase())||(null===(t=e.description)||void 0===t?void 0:t.toLowerCase().includes(u.toLowerCase()))||(null===(a=e.language)||void 0===a?void 0:a.toLowerCase().includes(u.toLowerCase()))||(null===(s=e.target_language)||void 0===s?void 0:s.toLowerCase().includes(u.toLowerCase()))}),M=e=>{switch(e){case"beginner":return"success";case"intermediate":return"warning";case"advanced":return"danger";case"expert":return"secondary";default:return"default"}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Vocabulary Groups"}),q&&q.totalWords>0&&(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Total words: ",q.totalWords]})]}),(0,s.jsxs)(i.z,{onClick:D,size:"sm",children:[(0,s.jsx)(j.Z,{className:"h-4 w-4 mr-2"}),"Manage Vocabulary"]})]}),y.length>0?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3",children:y.map(e=>{var t;let a=e.vocabulary_group,r=(null==a?void 0:null===(t=a.vocabulary_group_items)||void 0===t?void 0:t.length)||0;return(0,s.jsx)("div",{className:"border rounded-lg p-3 hover:shadow-md transition-shadow group relative",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsx)("h4",{className:"font-medium text-sm line-clamp-2",title:null==a?void 0:a.name,children:null==a?void 0:a.name}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>U(e.vocabulary_group_id),className:"opacity-0 group-hover:opacity-100 transition-opacity h-6 w-6 p-0 text-red-600 hover:text-red-700",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 flex-wrap",children:[(0,s.jsx)(c.C,{variant:M(null==a?void 0:a.difficulty),className:"text-xs px-1 py-0.5",children:null==a?void 0:a.difficulty}),(null==a?void 0:a.language)&&(null==a?void 0:a.target_language)&&(0,s.jsxs)(c.C,{variant:"outline",className:"text-xs px-1 py-0.5",children:[a.language,"→",a.target_language]})]}),(null==a?void 0:a.description)&&(0,s.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 line-clamp-2",title:a.description,children:a.description}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("span",{children:[r," word",1!==r?"s":""]}),(null==a?void 0:a.tags)&&a.tags.length>0&&(0,s.jsxs)("span",{children:[a.tags.length," tag",1!==a.tags.length?"s":""]})]})]})},e.id)})}):(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"No vocabulary groups added to this course yet."}),q&&q.totalWords>0&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[(0,s.jsx)("h4",{className:"font-medium mb-3",children:"Vocabulary Statistics"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"By Difficulty:"}),(0,s.jsx)("ul",{className:"space-y-1",children:Object.entries(q.byDifficulty).map(e=>{let[t,a]=e;return(0,s.jsxs)("li",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"capitalize text-gray-700 dark:text-gray-300",children:[t,":"]}),(0,s.jsx)("span",{className:"font-medium",children:a})]},t)})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:"By Part of Speech:"}),(0,s.jsxs)("ul",{className:"space-y-1",children:[Object.entries(q.byPartOfSpeech).slice(0,5).map(e=>{let[t,a]=e;return(0,s.jsxs)("li",{className:"flex justify-between",children:[(0,s.jsxs)("span",{className:"capitalize text-gray-700 dark:text-gray-300",children:[t,":"]}),(0,s.jsx)("span",{className:"font-medium",children:a})]},t)}),Object.keys(q.byPartOfSpeech).length>5&&(0,s.jsxs)("li",{className:"text-gray-500 dark:text-gray-400 text-xs",children:["+",Object.keys(q.byPartOfSpeech).length-5," more"]})]})]})]})]})]}),(0,s.jsx)(o.u,{isOpen:n,onClose:()=>d(!1),title:"Add Vocabulary Groups",size:"lg",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(l.R,{value:u,onSearch:m,placeholder:"Search vocabulary groups by name, description, or language..."}),C?(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)(x.Z,{className:"h-8 w-8 animate-spin text-gray-400"})}):B.length>0?(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:B.map(e=>{var t;return(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat(h.includes(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),onClick:()=>A(e.id),children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,s.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:()=>{},className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("h5",{className:"font-medium",children:e.name}),(0,s.jsx)(c.C,{variant:M(e.difficulty),size:"sm",children:e.difficulty}),e.language&&e.target_language&&(0,s.jsxs)(c.C,{variant:"outline",size:"sm",children:[e.language," → ",e.target_language]})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-1 text-xs text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("span",{children:[(null===(t=e.vocabulary_group_items)||void 0===t?void 0:t.length)||0," words"]}),e.tags&&e.tags.length>0&&(0,s.jsxs)("span",{children:[e.tags.length," tags"]})]})]})]}),(0,s.jsx)(k.Z,{className:"h-4 w-4 text-gray-400 mt-1"})]})},e.id)})}):(0,s.jsx)("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:u?"No vocabulary groups found matching your search.":"No available vocabulary groups to add."}),(0,s.jsxs)("div",{className:"flex justify-between items-center border-t pt-4",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[h.length," group",1!==h.length?"s":""," selected"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),(0,s.jsx)(i.z,{onClick:O,disabled:0===h.length||_,loading:_,children:"Add Groups"})]})]})]})})]})}var C=a(8296),S=a(64392);let q=(0,S.createClientComponentClient)(),L={async getObjectives(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=q.from("objectives").select("\n        *,\n        category:categories(id, name, color, icon)\n      ").order("created_at",{ascending:!1});e.categoryId&&(t=t.eq("category_id",e.categoryId)),e.bloomLevel&&(t=t.eq("bloom_level",e.bloomLevel)),void 0!==e.measurable&&(t=t.eq("measurable",e.measurable)),void 0!==e.isTemplate&&(t=t.eq("is_template",e.isTemplate)),e.search&&(t=t.or("title.ilike.%".concat(e.search,"%,description.ilike.%").concat(e.search,"%"))),e.tags&&e.tags.length>0&&(t=t.contains("tags",e.tags));let{data:a,error:s}=await t;if(s)throw s;return a},async getObjective(e){let{data:t,error:a}=await q.from("objectives").select("\n        *,\n        category:categories(id, name, color, icon)\n      ").eq("id",e).single();if(a)throw a;return t},async createObjective(e){var t,a;let{data:s}=await q.auth.getUser();if(!s.user)throw Error("User not authenticated");let{data:r,error:i}=await q.from("objectives").insert({...e,user_id:s.user.id,measurable:null===(t=e.measurable)||void 0===t||t,is_template:null!==(a=e.is_template)&&void 0!==a&&a}).select().single();if(i)throw i;return r},async updateObjective(e){let{id:t,...a}=e,{data:s,error:r}=await q.from("objectives").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return s},async deleteObjective(e){let{error:t}=await q.from("objectives").delete().eq("id",e);if(t)throw t},getBloomLevels:()=>[{value:"remember",label:"Remember"},{value:"understand",label:"Understand"},{value:"apply",label:"Apply"},{value:"analyze",label:"Analyze"},{value:"evaluate",label:"Evaluate"},{value:"create",label:"Create"}],async getObjectivesByCategory(e){let{data:t,error:a}=await q.from("objectives").select("*").eq("category_id",e).order("title",{ascending:!0});if(a)throw a;return t},async getTemplateObjectives(){let{data:e,error:t}=await q.from("objectives").select("*").eq("is_template",!0).order("title",{ascending:!0});if(t)throw t;return e},async cloneAsTemplate(e,t){let a=await this.getObjective(e);return this.createObjective({title:t||"".concat(a.title," (Template)"),description:a.description,category_id:a.category_id,bloom_level:a.bloom_level,measurable:a.measurable,tags:a.tags,is_template:!0})},async getObjectiveStats(){let{data:e}=await q.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await q.from("objectives").select("bloom_level, is_template",{count:"exact"}).eq("user_id",e.user.id);if(a)throw a;return{total:(null==t?void 0:t.length)||0,templates:(null==t?void 0:t.filter(e=>e.is_template).length)||0,byBloomLevel:{remember:(null==t?void 0:t.filter(e=>"remember"===e.bloom_level).length)||0,understand:(null==t?void 0:t.filter(e=>"understand"===e.bloom_level).length)||0,apply:(null==t?void 0:t.filter(e=>"apply"===e.bloom_level).length)||0,analyze:(null==t?void 0:t.filter(e=>"analyze"===e.bloom_level).length)||0,evaluate:(null==t?void 0:t.filter(e=>"evaluate"===e.bloom_level).length)||0,create:(null==t?void 0:t.filter(e=>"create"===e.bloom_level).length)||0}}}},T=(0,S.createClientComponentClient)(),z={async getMethods(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=T.from("methods").select("\n        *,\n        category:categories(id, name, color, icon)\n      ").order("created_at",{ascending:!1});e.categoryId&&(t=t.eq("category_id",e.categoryId)),void 0!==e.durationMin&&(t=t.gte("duration_minutes",e.durationMin)),void 0!==e.durationMax&&(t=t.lte("duration_minutes",e.durationMax)),void 0!==e.groupSizeMin&&(t=t.gte("group_size_min",e.groupSizeMin)),void 0!==e.groupSizeMax&&(t=t.lte("group_size_max",e.groupSizeMax)),void 0!==e.isTemplate&&(t=t.eq("is_template",e.isTemplate)),e.search&&(t=t.or("name.ilike.%".concat(e.search,"%,description.ilike.%").concat(e.search,"%,instructions.ilike.%").concat(e.search,"%"))),e.tags&&e.tags.length>0&&(t=t.contains("tags",e.tags));let{data:a,error:s}=await t;if(s)throw s;return a},async getMethod(e){let{data:t,error:a}=await T.from("methods").select("\n        *,\n        category:categories(id, name, color, icon)\n      ").eq("id",e).single();if(a)throw a;return t},async createMethod(e){var t,a;let{data:s}=await T.auth.getUser();if(!s.user)throw Error("User not authenticated");let{data:r,error:i}=await T.from("methods").insert({...e,user_id:s.user.id,group_size_min:null!==(t=e.group_size_min)&&void 0!==t?t:1,is_template:null!==(a=e.is_template)&&void 0!==a&&a}).select().single();if(i)throw i;return r},async updateMethod(e){let{id:t,...a}=e,{data:s,error:r}=await T.from("methods").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return s},async deleteMethod(e){let{error:t}=await T.from("methods").delete().eq("id",e);if(t)throw t},async getMethodsByCategory(e){let{data:t,error:a}=await T.from("methods").select("*").eq("category_id",e).order("name",{ascending:!0});if(a)throw a;return t},async getTemplateMethods(){let{data:e,error:t}=await T.from("methods").select("*").eq("is_template",!0).order("name",{ascending:!0});if(t)throw t;return e},async getMethodsByDuration(e,t){let{data:a,error:s}=await T.from("methods").select("*").gte("duration_minutes",e).lte("duration_minutes",t).order("duration_minutes",{ascending:!0});if(s)throw s;return a},async getMethodsByGroupSize(e){let{data:t,error:a}=await T.from("methods").select("*").lte("group_size_min",e).or("group_size_max.gte.".concat(e,",group_size_max.is.null")).order("name",{ascending:!0});if(a)throw a;return t},async cloneAsTemplate(e,t){let a=await this.getMethod(e);return this.createMethod({name:t||"".concat(a.name," (Template)"),description:a.description,category_id:a.category_id,instructions:a.instructions,duration_minutes:a.duration_minutes,group_size_min:a.group_size_min,group_size_max:a.group_size_max,materials_needed:a.materials_needed,tags:a.tags,is_template:!0})},async getMethodStats(){let{data:e}=await T.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await T.from("methods").select("duration_minutes, group_size_min, group_size_max, is_template",{count:"exact"}).eq("user_id",e.user.id);if(a)throw a;return{total:(null==t?void 0:t.length)||0,templates:(null==t?void 0:t.filter(e=>e.is_template).length)||0,averageDuration:(null==t?void 0:t.length)?Math.round(t.reduce((e,t)=>e+(t.duration_minutes||0),0)/t.length):0,byDurationRange:{short:(null==t?void 0:t.filter(e=>15>=(e.duration_minutes||0)).length)||0,medium:(null==t?void 0:t.filter(e=>(e.duration_minutes||0)>15&&45>=(e.duration_minutes||0)).length)||0,long:(null==t?void 0:t.filter(e=>(e.duration_minutes||0)>45).length)||0},byGroupSize:{individual:(null==t?void 0:t.filter(e=>1===(e.group_size_min||1)&&1===(e.group_size_max||1)).length)||0,small:(null==t?void 0:t.filter(e=>5>=(e.group_size_min||1)&&(e.group_size_max||100)>1).length)||0,large:(null==t?void 0:t.filter(e=>(e.group_size_min||1)>5).length)||0}}},async getPopularMaterials(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,{data:t}=await T.auth.getUser();if(!t.user)throw Error("User not authenticated");let{data:a,error:s}=await T.from("methods").select("materials_needed").eq("user_id",t.user.id).not("materials_needed","is",null);if(s)throw s;let r={};return null==a||a.forEach(e=>{var t;null===(t=e.materials_needed)||void 0===t||t.forEach(e=>{r[e]=(r[e]||0)+1})}),Object.entries(r).sort((e,t)=>{let[,a]=e,[,s]=t;return s-a}).slice(0,e).map(e=>{let[t,a]=e;return{material:t,count:a}})}},D=(0,S.createClientComponentClient)(),O={async getTasks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=D.from("tasks").select("\n        *,\n        category:categories(id, name, color, icon)\n      ").order("created_at",{ascending:!1});e.categoryId&&(t=t.eq("category_id",e.categoryId)),e.difficulty&&(t=t.eq("difficulty",e.difficulty)),void 0!==e.durationMin&&(t=t.gte("duration_minutes",e.durationMin)),void 0!==e.durationMax&&(t=t.lte("duration_minutes",e.durationMax)),void 0!==e.isTemplate&&(t=t.eq("is_template",e.isTemplate)),e.search&&(t=t.or("title.ilike.%".concat(e.search,"%,description.ilike.%").concat(e.search,"%,instructions.ilike.%").concat(e.search,"%"))),e.tags&&e.tags.length>0&&(t=t.contains("tags",e.tags));let{data:a,error:s}=await t;if(s)throw s;return a},async getTask(e){let{data:t,error:a}=await D.from("tasks").select("\n        *,\n        category:categories(id, name, color, icon)\n      ").eq("id",e).single();if(a)throw a;return t},async createTask(e){var t,a;let{data:s}=await D.auth.getUser();if(!s.user)throw Error("User not authenticated");let{data:r,error:i}=await D.from("tasks").insert({...e,user_id:s.user.id,difficulty:null!==(t=e.difficulty)&&void 0!==t?t:"beginner",is_template:null!==(a=e.is_template)&&void 0!==a&&a}).select().single();if(i)throw i;return r},async updateTask(e){let{id:t,...a}=e,{data:s,error:r}=await D.from("tasks").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(r)throw r;return s},async deleteTask(e){let{error:t}=await D.from("tasks").delete().eq("id",e);if(t)throw t},async getTasksByCategory(e){let{data:t,error:a}=await D.from("tasks").select("*").eq("category_id",e).order("title",{ascending:!0});if(a)throw a;return t},async getTemplateTasks(){let{data:e,error:t}=await D.from("tasks").select("*").eq("is_template",!0).order("title",{ascending:!0});if(t)throw t;return e},async getTasksByDifficulty(e){let{data:t,error:a}=await D.from("tasks").select("*").eq("difficulty",e).order("title",{ascending:!0});if(a)throw a;return t},async getTasksByDuration(e,t){let{data:a,error:s}=await D.from("tasks").select("*").gte("duration_minutes",e).lte("duration_minutes",t).order("duration_minutes",{ascending:!0});if(s)throw s;return a},async cloneAsTemplate(e,t){let a=await this.getTask(e);return this.createTask({title:t||"".concat(a.title," (Template)"),description:a.description,category_id:a.category_id,instructions:a.instructions,duration_minutes:a.duration_minutes,difficulty:a.difficulty,materials_needed:a.materials_needed,assessment_criteria:a.assessment_criteria,tags:a.tags,is_template:!0})},async getTaskStats(){let{data:e}=await D.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await D.from("tasks").select("difficulty, duration_minutes, is_template",{count:"exact"}).eq("user_id",e.user.id);if(a)throw a;return{total:(null==t?void 0:t.length)||0,templates:(null==t?void 0:t.filter(e=>e.is_template).length)||0,averageDuration:(null==t?void 0:t.length)?Math.round(t.reduce((e,t)=>e+(t.duration_minutes||0),0)/t.length):0,byDifficulty:{beginner:(null==t?void 0:t.filter(e=>"beginner"===e.difficulty).length)||0,intermediate:(null==t?void 0:t.filter(e=>"intermediate"===e.difficulty).length)||0,advanced:(null==t?void 0:t.filter(e=>"advanced"===e.difficulty).length)||0,expert:(null==t?void 0:t.filter(e=>"expert"===e.difficulty).length)||0},byDurationRange:{short:(null==t?void 0:t.filter(e=>15>=(e.duration_minutes||0)).length)||0,medium:(null==t?void 0:t.filter(e=>(e.duration_minutes||0)>15&&45>=(e.duration_minutes||0)).length)||0,long:(null==t?void 0:t.filter(e=>(e.duration_minutes||0)>45).length)||0}}},async getPopularMaterials(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,{data:t}=await D.auth.getUser();if(!t.user)throw Error("User not authenticated");let{data:a,error:s}=await D.from("tasks").select("materials_needed").eq("user_id",t.user.id).not("materials_needed","is",null);if(s)throw s;let r={};return null==a||a.forEach(e=>{var t;null===(t=e.materials_needed)||void 0===t||t.forEach(e=>{r[e]=(r[e]||0)+1})}),Object.entries(r).sort((e,t)=>{let[,a]=e,[,s]=t;return s-a}).slice(0,e).map(e=>{let[t,a]=e;return{material:t,count:a}})},async getTasksForLessonDuration(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,{data:a,error:s}=await D.from("tasks").select("*").lte("duration_minutes",e-t).order("duration_minutes",{ascending:!1});if(s)throw s;return a},getAssessmentCriteriaSuggestions:()=>["Accuracy of completion","Time management","Following instructions","Creativity and innovation","Collaboration and teamwork","Communication skills","Problem-solving approach","Quality of final product","Use of resources","Reflection and self-assessment"],getDifficultyDescriptions:()=>({beginner:"Basic concepts, minimal prior knowledge required",intermediate:"Some familiarity with topic, moderate complexity",advanced:"Strong foundation required, complex problem-solving",expert:"Mastery level, highly complex and nuanced tasks"})};var U=a(21902),A=a(37151),B=a(64590),M=a(92513),V=a(74697),F=a(40933),I=a(11240),E=a(24241);function Z(e){let{lessonId:t,onUpdate:a}=e,[n,d]=(0,r.useState)("objectives"),[u,m]=(0,r.useState)({objectives:[],methods:[],tasks:[],books:[],vocabulary:[]}),[h,g]=(0,r.useState)(!0),[v,y]=(0,r.useState)(!1),[_,k]=(0,r.useState)("objectives"),[N,S]=(0,r.useState)(""),[q,T]=(0,r.useState)([]),[D,Z]=(0,r.useState)([]),[P,G]=(0,r.useState)(!1),[R,H]=(0,r.useState)(!1),W=async()=>{g(!0);try{let e=await p.getLessonContent(t);m(e)}catch(e){console.error("Failed to load lesson content:",e)}finally{g(!1)}};(0,r.useEffect)(()=>{W()},[t]);let J=async e=>{G(!0);try{let t=[],a=u[e].map(t=>{switch(e){case"objectives":return t.objective_id;case"methods":return t.method_id;case"tasks":return t.task_id;case"books":return t.book_id;case"vocabulary":return t.vocabulary_id;default:return null}}).filter(Boolean);switch(e){case"objectives":t=(await L.getObjectives()).filter(e=>!a.includes(e.id));break;case"methods":t=(await z.getMethods()).filter(e=>!a.includes(e.id));break;case"tasks":t=(await O.getTasks()).filter(e=>!a.includes(e.id));break;case"books":t=(await f.a.getBooks()).filter(e=>!a.includes(e.id));break;case"vocabulary":t=(await w.A.getVocabulary()).filter(e=>!a.includes(e.id))}T(t)}catch(t){console.error("Failed to load available ".concat(e,":"),t)}finally{G(!1)}},Y=async e=>{k(e),y(!0),S(""),Z([]),await J(e)},Q=async(e,s)=>{if(confirm("Are you sure you want to remove this ".concat(e.slice(0,-1),"?")))try{switch(e){case"objectives":await p.removeObjectiveFromLesson(t,s);break;case"methods":await p.removeMethodFromLesson(t,s);break;case"tasks":await p.removeTaskFromLesson(t,s);break;case"books":await p.removeBookFromLesson(t,s);break;case"vocabulary":await p.removeVocabularyFromLesson(t,s)}await W(),null==a||a()}catch(t){console.error("Failed to remove ".concat(e,":"),t)}},$=async()=>{if(0!==D.length){H(!0);try{switch(_){case"objectives":await p.bulkAddObjectivesToLesson(t,D);break;case"methods":await p.bulkAddMethodsToLesson(t,D.map(e=>({methodId:e})));break;case"tasks":await p.bulkAddTasksToLesson(t,D.map(e=>({taskId:e})));break;case"books":for(let e of D)await p.addBookToLesson(t,e);break;case"vocabulary":for(let e of D)await p.addVocabularyToLesson(t,e)}await W(),null==a||a(),y(!1)}catch(e){console.error("Failed to add ".concat(_,":"),e)}finally{H(!1)}}},K=e=>{D.includes(e)?Z(D.filter(t=>t!==e)):Z([...D,e])},X=()=>N?q.filter(e=>{var t,a,s,r,i,o,l,n,c,d,u;let m=N.toLowerCase();switch(_){case"objectives":return(null===(t=e.title)||void 0===t?void 0:t.toLowerCase().includes(m))||(null===(a=e.description)||void 0===a?void 0:a.toLowerCase().includes(m));case"methods":return(null===(s=e.name)||void 0===s?void 0:s.toLowerCase().includes(m))||(null===(r=e.description)||void 0===r?void 0:r.toLowerCase().includes(m));case"tasks":return(null===(i=e.title)||void 0===i?void 0:i.toLowerCase().includes(m))||(null===(o=e.description)||void 0===o?void 0:o.toLowerCase().includes(m));case"books":return(null===(l=e.title)||void 0===l?void 0:l.toLowerCase().includes(m))||(null===(n=e.author)||void 0===n?void 0:n.toLowerCase().includes(m))||(null===(c=e.isbn)||void 0===c?void 0:c.toLowerCase().includes(m));case"vocabulary":return(null===(d=e.word)||void 0===d?void 0:d.toLowerCase().includes(m))||(null===(u=e.translation)||void 0===u?void 0:u.toLowerCase().includes(m));default:return!0}}):q,ee=[{key:"objectives",label:"Objectives",icon:(0,s.jsx)(U.Z,{className:"h-4 w-4"}),count:u.objectives.length},{key:"methods",label:"Methods",icon:(0,s.jsx)(A.Z,{className:"h-4 w-4"}),count:u.methods.length},{key:"tasks",label:"Tasks",icon:(0,s.jsx)(B.Z,{className:"h-4 w-4"}),count:u.tasks.length},{key:"books",label:"Books",icon:(0,s.jsx)(b.Z,{className:"h-4 w-4"}),count:u.books.length},{key:"vocabulary",label:"Vocabulary",icon:(0,s.jsx)(j.Z,{className:"h-4 w-4"}),count:u.vocabulary.length}],et=()=>{if(h)return(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)(x.Z,{className:"h-8 w-8 animate-spin text-gray-400"})});if(0===u[n].length)return(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsxs)("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["No ",n," added to this lesson yet."]}),(0,s.jsxs)(i.z,{onClick:()=>Y(n),children:[(0,s.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"Add ",n]})]});switch(n){case"objectives":return(0,s.jsx)("div",{className:"space-y-3",children:u.objectives.map(e=>{var t,a,r,o;return(0,s.jsxs)("div",{className:"flex items-start justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:null===(t=e.objective)||void 0===t?void 0:t.title}),(null===(a=e.objective)||void 0===a?void 0:a.description)&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.objective.description}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(null===(r=e.objective)||void 0===r?void 0:r.bloom_level)&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.objective.bloom_level}),(null===(o=e.objective)||void 0===o?void 0:o.category)&&(0,s.jsx)(c.C,{variant:"secondary",size:"sm",children:e.objective.category})]})]}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>Q("objectives",e.objective_id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,s.jsx)(V.Z,{className:"h-4 w-4"})})]},e.id)})});case"methods":return(0,s.jsx)("div",{className:"space-y-3",children:u.methods.map(e=>{var t,a,r,o,l,n;return(0,s.jsxs)("div",{className:"flex items-start justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:null===(t=e.method)||void 0===t?void 0:t.name}),(null===(a=e.method)||void 0===a?void 0:a.description)&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.method.description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(F.Z,{className:"h-3 w-3"}),e.duration_override||(null===(r=e.method)||void 0===r?void 0:r.duration_minutes)," min"]}),(null===(o=e.method)||void 0===o?void 0:o.group_size_min)&&(null===(l=e.method)||void 0===l?void 0:l.group_size_max)&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(I.Z,{className:"h-3 w-3"}),e.method.group_size_min,"-",e.method.group_size_max]}),(null===(n=e.method)||void 0===n?void 0:n.category)&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.method.category})]}),e.notes&&(0,s.jsxs)("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Note: ",e.notes]})]}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>Q("methods",e.method_id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,s.jsx)(V.Z,{className:"h-4 w-4"})})]},e.id)})});case"tasks":return(0,s.jsx)("div",{className:"space-y-3",children:u.tasks.map(e=>{var t,a,r,o;return(0,s.jsxs)("div",{className:"flex items-start justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h4",{className:"font-medium",children:null===(t=e.task)||void 0===t?void 0:t.title}),e.is_homework&&(0,s.jsx)(c.C,{variant:"warning",size:"sm",children:"Homework"})]}),(null===(a=e.task)||void 0===a?void 0:a.description)&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.task.description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(F.Z,{className:"h-3 w-3"}),e.duration_override||(null===(r=e.task)||void 0===r?void 0:r.duration_minutes)," min"]}),(null===(o=e.task)||void 0===o?void 0:o.difficulty)&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.task.difficulty}),e.due_date&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(E.Z,{className:"h-3 w-3"}),"Due: ",new Date(e.due_date).toLocaleDateString()]})]}),e.notes&&(0,s.jsxs)("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["Note: ",e.notes]})]}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>Q("tasks",e.task_id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,s.jsx)(V.Z,{className:"h-4 w-4"})})]},e.id)})});case"books":return(0,s.jsx)("div",{className:"space-y-3",children:u.books.map(e=>{var t,a,r;return(0,s.jsxs)("div",{className:"flex items-start justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(null===(t=e.book)||void 0===t?void 0:t.cover_image_url)&&(0,s.jsx)("img",{src:e.book.cover_image_url,alt:e.book.title,className:"w-12 h-16 object-cover rounded"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:null===(a=e.book)||void 0===a?void 0:a.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:null===(r=e.book)||void 0===r?void 0:r.author}),(e.pages_from||e.pages_to)&&(0,s.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Pages: ",e.pages_from||"?"," - ",e.pages_to||"?"]}),e.notes&&(0,s.jsxs)("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-1",children:["Note: ",e.notes]})]})]}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>Q("books",e.book_id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,s.jsx)(V.Z,{className:"h-4 w-4"})})]},e.id)})});case"vocabulary":return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:u.vocabulary.map(e=>{var t,a,r,o;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-medium",children:null===(t=e.vocabulary)||void 0===t?void 0:t.word}),(null===(a=e.vocabulary)||void 0===a?void 0:a.translation)&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.vocabulary.translation}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(null===(r=e.vocabulary)||void 0===r?void 0:r.part_of_speech)&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.vocabulary.part_of_speech}),(null===(o=e.vocabulary)||void 0===o?void 0:o.difficulty)&&(0,s.jsx)(c.C,{variant:"secondary",size:"sm",children:e.vocabulary.difficulty})]})]}),(0,s.jsx)(i.z,{variant:"ghost",size:"sm",onClick:()=>Q("vocabulary",e.vocabulary_id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20",children:(0,s.jsx)(V.Z,{className:"h-4 w-4"})})]},e.id)})});default:return null}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Lesson Content"}),(0,s.jsxs)(i.z,{size:"sm",onClick:()=>Y(n),disabled:h,children:[(0,s.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"Add ",n.slice(0,-1)]})]}),(0,s.jsxs)(C.mQ,{value:n,onValueChange:d,children:[" ",(0,s.jsxs)(C.dr,{className:"w-full justify-start overflow-x-auto",children:[" ",ee.map(e=>(0,s.jsxs)(C.SP,{value:e.key,children:[" ",(0,s.jsxs)("span",{className:"flex items-center gap-2",children:[" ",e.icon," ",e.label," ",e.count>0&&(0,s.jsxs)(c.C,{variant:"secondary",className:"ml-1",children:[" ",e.count," "]})]})]},e.key))]}),ee.map(e=>(0,s.jsx)(C.nU,{value:e.key,children:et()},e.key))]}),(0,s.jsx)(o.u,{isOpen:v,onClose:()=>y(!1),title:"Add ".concat(_.charAt(0).toUpperCase()+_.slice(1)," to Lesson"),size:"lg",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(l.R,{value:N,onSearch:S,placeholder:"Search ".concat(_,"...")}),(()=>{let e=X();if(P)return(0,s.jsx)("div",{className:"flex justify-center py-8",children:(0,s.jsx)(x.Z,{className:"h-8 w-8 animate-spin text-gray-400"})});if(0===e.length)return(0,s.jsx)("p",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:N?"No ".concat(_," found matching your search."):"No available ".concat(_," to add.")});switch(_){case"objectives":return(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.map(e=>(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat(D.includes(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),onClick:()=>K(e.id),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>{},className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h5",{className:"font-medium",children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[e.bloom_level&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.bloom_level}),e.category&&(0,s.jsx)(c.C,{variant:"secondary",size:"sm",children:e.category})]})]})]})},e.id))});case"methods":return(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.map(e=>(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat(D.includes(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),onClick:()=>K(e.id),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>{},className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h5",{className:"font-medium",children:e.name}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-sm text-gray-500",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(F.Z,{className:"h-3 w-3"}),e.duration_minutes," min"]}),e.group_size_min&&e.group_size_max&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(I.Z,{className:"h-3 w-3"}),e.group_size_min,"-",e.group_size_max]})]})]})]})},e.id))});case"tasks":return(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.map(e=>(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat(D.includes(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),onClick:()=>K(e.id),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>{},className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h5",{className:"font-medium",children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[(0,s.jsx)(F.Z,{className:"h-3 w-3 inline mr-1"}),e.duration_minutes," min"]}),e.difficulty&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.difficulty})]})]})]})},e.id))});case"books":return(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.map(e=>(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat(D.includes(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),onClick:()=>K(e.id),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>{},className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),e.cover_image_url&&(0,s.jsx)("img",{src:e.cover_image_url,alt:e.title,className:"w-12 h-16 object-cover rounded"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h5",{className:"font-medium",children:e.title}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.author}),e.isbn&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["ISBN: ",e.isbn]})]})]})},e.id))});case"vocabulary":return(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:e.map(e=>(0,s.jsx)("div",{className:"p-3 border rounded-lg cursor-pointer transition-all ".concat(D.includes(e.id)?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800"),onClick:()=>K(e.id),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>{},className:"mt-1 rounded border-gray-300 text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h5",{className:"font-medium",children:e.word}),e.translation&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.translation}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[e.part_of_speech&&(0,s.jsx)(c.C,{variant:"outline",size:"sm",children:e.part_of_speech}),e.difficulty&&(0,s.jsx)(c.C,{variant:"secondary",size:"sm",children:e.difficulty})]})]})]})},e.id))});default:return null}})(),(0,s.jsxs)("div",{className:"flex justify-between items-center border-t pt-4",children:[(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[D.length," ",_.slice(0,-1),1!==D.length?"s":""," selected"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(i.z,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),(0,s.jsxs)(i.z,{onClick:$,disabled:0===D.length||R,loading:R,children:["Add ",_]})]})]})]})})]})}var P=a(16463),G=a(36520),R=a(86201),H=a(64608),W=a(49321),J=a(87592);function Y(e){let{courseId:t}=e,a=(0,P.useRouter)(),[o,l]=(0,r.useState)([]),[n,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(!0);(0,r.useEffect)(()=>{h()},[t]);let h=async()=>{m(!0);try{let e=await G.y.getSchedule(t);if(l(e),e.length>0){let t=[];for(let a of e){let e=await R.p.getScheduleLessons(a.id);t.push(...e.map(e=>({...e,schedule:a})))}t.sort((e,t)=>{let a=new Date(e.date).getTime()-new Date(t.date).getTime();return 0!==a?a:e.start_time.localeCompare(t.start_time)}),d(t)}}catch(e){console.error("Failed to load schedules and lessons:",e)}finally{m(!1)}},g=e=>{try{return new Date("2000-01-01T".concat(e)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(t){return e}},v=e=>{try{return new Date(e).toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"})}catch(t){return e}},y=e=>{switch(e){case"completed":return"success";case"cancelled":return"danger";default:return"default"}};return u?(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-gray-100 mx-auto"})}):0===o.length?(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)(E.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"No schedules yet"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:"Create a teaching schedule for this course"}),(0,s.jsxs)(i.z,{className:"mt-4",size:"sm",onClick:()=>a.push("/schedules/new?courseId=".concat(t)),children:[(0,s.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"Create Schedule"]})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"Course Schedules"}),(0,s.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[o.length," schedule",1!==o.length?"s":"",", ",n.length," lesson",1!==n.length?"s":""]})]}),(0,s.jsxs)(i.z,{variant:"outline",size:"sm",onClick:()=>a.push("/schedules/new?courseId=".concat(t)),children:[(0,s.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"New Schedule"]})]}),(0,s.jsx)("div",{className:"space-y-3",children:n.map(e=>(0,s.jsx)(H.Z,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>a.push("/lessons/".concat(e.id)),children:(0,s.jsx)(H.Z.Content,{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsxs)("h4",{className:"font-medium text-lg",children:["Lesson ",e.lesson_number,": ",e.topic]}),(0,s.jsx)(c.C,{variant:y(e.status),size:"sm",children:e.status})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:e.description}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(E.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:v(e.date)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(F.Z,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[g(e.start_time)," - ",g(e.end_time)]})]}),e.location&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(W.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:e.location})]}),e.max_students&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(I.Z,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:["Max ",e.max_students]})]})]}),e.schedule&&(0,s.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Schedule: ",e.schedule.name]})]}),(0,s.jsx)(J.Z,{className:"h-5 w-5 text-gray-400 flex-shrink-0 ml-4"})]})})},e.id))})]})}},44316:function(e,t,a){a.d(t,{J:function(){return r}});var s=a(64392);let r=()=>(0,s.createClientComponentClient)()},46749:function(e,t,a){a.d(t,{a:function(){return r}});let s=(0,a(64392).createClientComponentClient)(),r={async getBooks(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.from("books").select("\n        *,\n        category:categories(id, name, color, icon),\n        vocabulary_group_books(\n          vocabulary_group:vocabulary_groups(\n            id,\n            name,\n            difficulty\n          )\n        )\n      ").order("created_at",{ascending:!1});e.search&&(t=t.or("title.ilike.%".concat(e.search,"%,author.ilike.%").concat(e.search,"%,description.ilike.%").concat(e.search,"%"))),e.author&&(t=t.ilike("author","%".concat(e.author,"%"))),e.categoryId&&(t=t.eq("category_id",e.categoryId)),e.contentType&&(t=t.eq("content_type",e.contentType)),e.language&&(t=t.eq("language",e.language)),e.publicationYear&&(t=t.eq("publication_year",e.publicationYear)),void 0!==e.isPublic&&(t=t.eq("is_public",e.isPublic)),e.tags&&e.tags.length>0&&(t=t.contains("tags",e.tags));let{data:a,error:r}=await t;if(r)throw r;return a},async getBook(e){let{data:t,error:a}=await s.from("books").select("\n        *,\n        category:categories(id, name, color, icon),\n        course_books(\n          id,\n          course_id,\n          is_required,\n          notes,\n          position,\n          course:courses(id, title, status)\n        )\n      ").eq("id",e).single();if(a)throw a;return t},async createBook(e){let{data:t}=await s.auth.getUser();if(!t.user)throw Error("User not authenticated");let a={...e,language:e.language||"en",is_public:e.is_public||!1,user_id:t.user.id},{data:r,error:i}=await s.from("books").insert(a).select().single();if(i)throw i;return r},async updateBook(e){let{id:t,...a}=e,{data:r,error:i}=await s.from("books").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return r},async deleteBook(e){let{error:t}=await s.from("books").delete().eq("id",e);if(t)throw t},async getBookStats(){let{data:e}=await s.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await s.from("books").select("content_type",{count:"exact"}).eq("user_id",e.user.id);if(a)throw a;return{total:(null==t?void 0:t.length)||0,text:(null==t?void 0:t.filter(e=>"text"===e.content_type).length)||0,video:(null==t?void 0:t.filter(e=>"video"===e.content_type).length)||0,audio:(null==t?void 0:t.filter(e=>"audio"===e.content_type).length)||0,pdf:(null==t?void 0:t.filter(e=>"pdf"===e.content_type).length)||0,other:(null==t?void 0:t.filter(e=>["image","interactive"].includes(e.content_type)).length)||0}},async getAuthors(){let{data:e}=await s.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await s.from("books").select("author").eq("user_id",e.user.id).not("author","is",null);if(a)throw a;return Array.from(new Set(null==t?void 0:t.map(e=>e.author).filter(Boolean))).sort()},async getLanguages(){let{data:e}=await s.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await s.from("books").select("language").eq("user_id",e.user.id);if(a)throw a;return Array.from(new Set(null==t?void 0:t.map(e=>e.language).filter(Boolean))).sort()},getContentTypes:()=>[{value:"text",label:"Text",icon:"\uD83D\uDCC4"},{value:"pdf",label:"PDF",icon:"\uD83D\uDCD1"},{value:"video",label:"Video",icon:"\uD83C\uDFA5"},{value:"audio",label:"Audio",icon:"\uD83C\uDFA7"},{value:"image",label:"Image",icon:"\uD83D\uDDBC️"},{value:"interactive",label:"Interactive",icon:"\uD83C\uDFAE"}]}},86201:function(e,t,a){a.d(t,{p:function(){return r}});let s=(0,a(64392).createClientComponentClient)(),r={async getLessons(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.from("lessons").select("\n        *,\n        schedule:schedules(id, name, course:courses(id, title))\n      ").order("date",{ascending:!0}).order("start_time",{ascending:!0});e.schedule_id&&(t=t.eq("schedule_id",e.schedule_id)),e.status&&(t=t.eq("status",e.status)),e.date_from&&(t=t.gte("date",e.date_from)),e.date_to&&(t=t.lte("date",e.date_to)),e.user_id&&(t=t.eq("user_id",e.user_id));let{data:a,error:r}=await t;if(r)throw r;return a},async getScheduleLessons(e){let{data:t,error:a}=await s.from("lessons").select("*").eq("schedule_id",e).order("date",{ascending:!0}).order("start_time",{ascending:!0});if(a)throw a;return t},async getLesson(e){let{data:t,error:a}=await s.from("lessons").select("\n        *,\n        schedule:schedules(*, course:courses(*)),\n        objectives:lesson_objectives(*, objective:objectives(*)),\n        methods:lesson_methods(*, method:methods(*)),\n        tasks:lesson_tasks(*, task:tasks(*)),\n        books:lesson_books(*, book:books(*)),\n        vocabulary:lesson_vocabulary(*, vocabulary:vocabulary(*)),\n        attendance(*)\n      ").eq("id",e).single();if(a)throw a;return t},async createLesson(e){let{data:t}=await s.auth.getUser();if(!t.user)throw Error("User not authenticated");let{data:a,error:r}=await s.from("lessons").insert({...e,user_id:t.user.id}).select().single();if(r)throw r;return a},async updateLesson(e,t){let{data:a,error:r}=await s.from("lessons").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw r;return a},async deleteLesson(e){let{error:t}=await s.from("lessons").delete().eq("id",e);if(t)throw t},async getAttendance(e){let{data:t,error:a}=await s.from("attendance").select("*").eq("lesson_id",e).order("student_name");if(a)throw a;return t},async markAttendance(e){let{data:t}=await s.auth.getUser();if(!t.user)throw Error("User not authenticated");let{data:a,error:r}=await s.from("attendance").upsert({...e,marked_at:new Date().toISOString(),marked_by:t.user.id}).select().single();if(r)throw r;return a},async bulkMarkAttendance(e,t){let{data:a}=await s.auth.getUser();if(!a.user)throw Error("User not authenticated");let r=t.map(t=>({...t,lesson_id:e,marked_at:new Date().toISOString(),marked_by:a.user.id})),{data:i,error:o}=await s.from("attendance").upsert(r).select();if(o)throw o;return i}}},36520:function(e,t,a){a.d(t,{y:function(){return i}});let s=(0,a(64392).createClientComponentClient)();async function r(e,t){let a=[],r=new Date("".concat(t.start_date,"T00:00:00Z")),i=t.end_date?new Date("".concat(t.end_date,"T00:00:00Z")):new Date(r.getFullYear()+1,r.getMonth(),r.getDate()),o=new Date(r),l=1,n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;o<=i;){var c;let s=n[o.getUTCDay()];if(null===(c=t.recurrence_days)||void 0===c?void 0:c.includes(s)){let[s,r]=t.default_start_time.split(":").map(Number),i=new Date(o);i.setUTCHours(s,r,0,0);let n=new Date(i);n.setUTCMinutes(i.getUTCMinutes()+t.default_duration_minutes),a.push({schedule_id:e,course_id:t.course_id,user_id:t.user_id,title:"".concat(t.name," - Lesson ").concat(l),date:o.toISOString().split("T")[0],start_time:i.toUTCString().slice(17,22),end_time:n.toUTCString().slice(17,22),duration_minutes:t.default_duration_minutes,location:t.location,status:"scheduled"}),l++}o.setUTCDate(o.getUTCDate()+1)}if(a.length>0){let{error:e}=await s.from("lessons").insert(a);if(e)throw e}}let i={async getSchedules(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.from("schedules").select("\n        *,\n        course:courses(id, title),\n        lessons(count)\n      ").order("created_at",{ascending:!1});e.course_id&&(t=t.eq("course_id",e.course_id)),void 0!==e.is_active&&(t=t.eq("is_active",e.is_active)),e.user_id&&(t=t.eq("user_id",e.user_id));let{data:a,error:r}=await t;if(r)throw r;return a},async getSchedule(e){let{data:t,error:a}=await s.from("schedules").select("\n        *,\n        course:courses(*),\n        lessons(*)\n      ").eq("id",e).single();if(a)throw a;return t},async createSchedule(e){let{data:t}=await s.auth.getUser();if(!t.user)throw Error("User not authenticated");let{data:a,error:i}=await s.from("schedules").insert({...e,user_id:t.user.id}).select().single();if(i)throw i;return a&&"none"!==e.recurrence_type&&await r(a.id,{...e,user_id:t.user.id}),a},async updateSchedule(e,t){let{data:a,error:r}=await s.from("schedules").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(r)throw r;return a},async deleteSchedule(e){let{error:t}=await s.from("schedules").delete().eq("id",e);if(t)throw t}}},31868:function(e,t,a){a.d(t,{A:function(){return r}});let s=(0,a(64392).createClientComponentClient)(),r={async getVocabulary(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.from("vocabulary").select("*").order("word",{ascending:!0});e.search&&(t=t.or("word.ilike.%".concat(e.search,"%,translation.ilike.%").concat(e.search,"%,definition.ilike.%").concat(e.search,"%"))),e.difficulty&&(t=t.eq("difficulty",e.difficulty)),e.partOfSpeech&&(t=t.eq("part_of_speech",e.partOfSpeech)),e.tags&&e.tags.length>0&&(t=t.contains("tags",e.tags));let{data:a,error:r}=await t;if(r)throw r;return a},async getVocabularyInGroup(e){let{data:t,error:a}=await s.from("vocabulary_group_items").select("\n        *,\n        vocabulary(*)\n      ").eq("vocabulary_group_id",e).order("position",{ascending:!0});if(a)throw a;return t},async getVocabularyItem(e){let{data:t,error:a}=await s.from("vocabulary").select("*").eq("id",e).single();if(a)throw a;return t},async createVocabulary(e){let{data:t}=await s.auth.getUser();if(!t.user)throw Error("User not authenticated");let a={...e,difficulty:e.difficulty||"beginner",user_id:t.user.id},{data:r,error:i}=await s.from("vocabulary").insert(a).select().single();if(i)throw i;return r},async updateVocabulary(e){let{id:t,...a}=e,{data:r,error:i}=await s.from("vocabulary").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return r},async deleteVocabulary(e){let{error:t}=await s.from("vocabulary").delete().eq("id",e);if(t)throw t},async getVocabularyGroups(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=s.from("vocabulary_groups").select("\n        *,\n        category:categories(id, name, color, icon),\n        vocabulary_group_items(count),\n        vocabulary_group_books(\n          book:books(\n            id,\n            title,\n            author,\n            cover_image_url\n          )\n        )\n      ").order("created_at",{ascending:!1});e.search&&(t=t.or("name.ilike.%".concat(e.search,"%,description.ilike.%").concat(e.search,"%"))),e.difficulty&&(t=t.eq("difficulty",e.difficulty)),e.language&&(t=t.eq("language",e.language)),e.targetLanguage&&(t=t.eq("target_language",e.targetLanguage)),e.categoryId&&(t=t.eq("category_id",e.categoryId)),void 0!==e.isPublic&&(t=t.eq("is_public",e.isPublic)),e.tags&&e.tags.length>0&&(t=t.contains("tags",e.tags));let{data:a,error:r}=await t;if(r)throw r;return(null==a?void 0:a.map(e=>{var t,a;return{...e,vocabulary_count:(null===(a=e.vocabulary_group_items)||void 0===a?void 0:null===(t=a[0])||void 0===t?void 0:t.count)||0}}))||[]},async getVocabularyGroup(e){let{data:t,error:a}=await s.from("vocabulary_groups").select("\n        *,\n        category:categories(id, name, color, icon),\n        vocabulary_group_items(\n          *,\n          vocabulary(*)\n        )\n      ").eq("id",e).single();if(a)throw a;return t},async createVocabularyGroup(e){let{data:t}=await s.auth.getUser();if(!t.user)throw Error("User not authenticated");let a={...e,language:e.language||"en",difficulty:e.difficulty||"beginner",is_public:e.is_public||!1,user_id:t.user.id},{data:r,error:i}=await s.from("vocabulary_groups").insert(a).select().single();if(i)throw i;return r},async updateVocabularyGroup(e){let{id:t,...a}=e,{data:r,error:i}=await s.from("vocabulary_groups").update({...a,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(i)throw i;return r},async deleteVocabularyGroup(e){let{error:t}=await s.from("vocabulary_groups").delete().eq("id",e);if(t)throw t},async addVocabularyToGroup(e,t,a){if(void 0===a){let{data:e}=await s.from("vocabulary_group_items").select("position").eq("vocabulary_group_id",t).order("position",{ascending:!1}).limit(1);a=e&&e.length>0?e[0].position+1:0}let{data:r,error:i}=await s.from("vocabulary_group_items").insert({vocabulary_group_id:t,vocabulary_id:e,position:a}).select().single();if(i)throw i;return r},async removeVocabularyFromGroup(e,t){let{error:a}=await s.from("vocabulary_group_items").delete().eq("vocabulary_group_id",t).eq("vocabulary_id",e);if(a)throw a},async updateVocabularyPosition(e,t,a){let{data:r,error:i}=await s.from("vocabulary_group_items").update({position:a}).eq("vocabulary_group_id",t).eq("vocabulary_id",e).select().single();if(i)throw i;return r},async getVocabularyStats(){var e,t,a,r,i,o,l,n,c,d;let{data:u}=await s.auth.getUser();if(!u.user)throw Error("User not authenticated");let[m,h]=await Promise.all([s.from("vocabulary").select("difficulty",{count:"exact"}).eq("user_id",u.user.id),s.from("vocabulary_groups").select("difficulty",{count:"exact"}).eq("user_id",u.user.id)]);if(m.error)throw m.error;if(h.error)throw h.error;return{vocabulary:{total:(null===(e=m.data)||void 0===e?void 0:e.length)||0,beginner:(null===(t=m.data)||void 0===t?void 0:t.filter(e=>"beginner"===e.difficulty).length)||0,intermediate:(null===(a=m.data)||void 0===a?void 0:a.filter(e=>"intermediate"===e.difficulty).length)||0,advanced:(null===(r=m.data)||void 0===r?void 0:r.filter(e=>"advanced"===e.difficulty).length)||0,expert:(null===(i=m.data)||void 0===i?void 0:i.filter(e=>"expert"===e.difficulty).length)||0},groups:{total:(null===(o=h.data)||void 0===o?void 0:o.length)||0,beginner:(null===(l=h.data)||void 0===l?void 0:l.filter(e=>"beginner"===e.difficulty).length)||0,intermediate:(null===(n=h.data)||void 0===n?void 0:n.filter(e=>"intermediate"===e.difficulty).length)||0,advanced:(null===(c=h.data)||void 0===c?void 0:c.filter(e=>"advanced"===e.difficulty).length)||0,expert:(null===(d=h.data)||void 0===d?void 0:d.filter(e=>"expert"===e.difficulty).length)||0}}},async getPartsOfSpeech(){let{data:e}=await s.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await s.from("vocabulary").select("part_of_speech").eq("user_id",e.user.id).not("part_of_speech","is",null);if(a)throw a;return Array.from(new Set(null==t?void 0:t.map(e=>e.part_of_speech).filter(Boolean))).sort()},async getLanguages(){let{data:e}=await s.auth.getUser();if(!e.user)throw Error("User not authenticated");let{data:t,error:a}=await s.from("vocabulary_groups").select("language, target_language").eq("user_id",e.user.id);if(a)throw a;let r=new Set;return null==t||t.forEach(e=>{e.language&&r.add(e.language),e.target_language&&r.add(e.target_language)}),Array.from(r).sort()},getDifficultyLevels:()=>[{value:"beginner",label:"Beginner",color:"green"},{value:"intermediate",label:"Intermediate",color:"yellow"},{value:"advanced",label:"Advanced",color:"orange"},{value:"expert",label:"Expert",color:"red"}],getPartsOfSpeechOptions:()=>[{value:"noun",label:"Noun"},{value:"verb",label:"Verb"},{value:"adjective",label:"Adjective"},{value:"adverb",label:"Adverb"},{value:"pronoun",label:"Pronoun"},{value:"preposition",label:"Preposition"},{value:"conjunction",label:"Conjunction"},{value:"interjection",label:"Interjection"},{value:"article",label:"Article"}]}}}]);